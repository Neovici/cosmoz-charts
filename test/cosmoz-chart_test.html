<!doctype html>
<html lang="en">
	<head>
		<meta charset="utf-8">
		<meta name="viewport" content="width=device-width, minimum-scale=1, initial-scale=1, user-scalable=yes">

		<title>cosmoz-charts test</title>

		<script src="/components/@webcomponents/webcomponentsjs/webcomponents-loader.js"></script>
		<script src="/components/@polymer/test-fixture/test-fixture.js?nocompile"></script>
		<script src="/components/mocha/mocha.js?nocompile"></script>
		<script src="/components/chai/chai.js?nocompile"></script>
		<script src="/components/wct-mocha/wct-mocha.js?nocompile"></script>
		<script src="/components/sinon/pkg/sinon.js?nocompile"></script>
		<script src="/components/sinon-chai/lib/sinon-chai.js?nocompile"></script>

		<link rel="stylesheet" href="/components/billboard.js/dist/billboard.css">

		<script type="module" src="../cosmoz-chart.js"></script>
	</head>
	<body>

		<test-fixture id="BasicTestFixture">
			<template is="dom-template">
				<cosmoz-chart data="[[data]]" axis="[[axis]]" line="[[line]]" config="[[config]]"></cosmoz-chart>
			</template>
		</test-fixture>

		<test-fixture id="HiddenTestFixture">
			<template is="dom-template">
					<cosmoz-chart style="display:none" data="[[data]]" config="[[config]]"></cosmoz-chart>
			</template>
		</test-fixture>

		<script type="module">
		import { tap } from '@polymer/iron-test-helpers/mock-interactions.js';
		import { upgradeDomTemplates } from './helpers/utils.js';
		upgradeDomTemplates();

		describe('cosmoz-chart', () => {

			describe('resize', () => {
				it('triggers a chart resize', () => {
					const element = fixture('BasicTestFixture', {
						data: {
							columns: [['data1', 10, 20, 30]]
						},
						config: {
							axis: {
								x: { show: false }
							}
						}
					});
					element.style.width = '100px';

					expect(element.querySelector('svg').getAttribute('width')).to.equal('900');
					element.resize();
					expect(element.querySelector('svg').getAttribute('width')).to.equal('100');
				});
			});

			it('forces re-rendering after element becomes visible [#15]', () => {
				const element = fixture('HiddenTestFixture', {
					data: {
						columns: [
							['data1', 1, 2, 3],
							['data2', 1, 2, 3],
							['data3', 1, 2, 3],
							['data4', 1, 2, 3],
							['data5', 1, 2, 3],
							['data6', 1, 2, 3],
							['data7', 1, 2, 3],
							['data8', 1, 2, 3]
						]
					}
				});

				element.style.display = 'block';
				element.resize(true);

				expect(element.querySelectorAll('.bb-legend-item text')).to.not.overlap();
				expect(element.querySelector('g:nth-of-type(1)').getBoundingClientRect().height).to.be.above(280);
			});
		});
		</script>
	</body>
</html>
